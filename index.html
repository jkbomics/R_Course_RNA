<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R for Transcriptomics &amp; Single-Cell</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            min-height: 100%;
            background: #0a0a0a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        /* Dynamic Code Background */
        .code-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
        }

        .code-line {
            position: absolute;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff41;
            white-space: nowrap;
            animation: scrollCode linear infinite;
        }

        @keyframes scrollCode {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        html {
            height: 100%;
        }

        /* Floating R Programming Objects */
        .floating-objects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .floating-object {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .floating-object:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .floating-object:nth-child(2) { top: 20%; right: 10%; animation-delay: 1s; }
        .floating-object:nth-child(3) { top: 60%; left: 15%; animation-delay: 2s; }
        .floating-object:nth-child(4) { bottom: 20%; right: 20%; animation-delay: 3s; }
        .floating-object:nth-child(5) { top: 40%; left: 70%; animation-delay: 4s; }
        .floating-object:nth-child(6) { bottom: 10%; left: 30%; animation-delay: 5s; }
        .floating-object:nth-child(7) { top: 30%; right: 5%; animation-delay: 6s; }
        .floating-object:nth-child(8) { bottom: 40%; left: 60%; animation-delay: 7s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            color: #00ff41;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #00cc33;
            font-weight: 300;
        }

        .phases-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .phase-card {
            background: rgba(20, 20, 20, 0.9);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.15);
            transition: all 0.3s ease;
            border: 2px solid rgba(0, 255, 65, 0.2);
            position: relative;
            overflow: hidden;
        }

        .phase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(42, 138, 146, 0.25);
            border-color: #aad0d4;
        }

        .phase-button {
            width: 100%;
            background: linear-gradient(135deg, #68b8c1, #2a8a92);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .phase-button:hover {
            background: linear-gradient(135deg, #2a8a92, #68b8c1);
            transform: scale(1.02);
        }

        .phase-button:active {
            transform: scale(0.98);
        }

        .lessons-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 0;
        }

        .lessons-container.expanded {
            max-height: 500px;
            margin-top: 1rem;
        }

        .lesson-item {
            background: linear-gradient(135deg, #c3e1e5, #aad0d4);
            margin: 0.5rem 0;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            transform: translateX(-20px);
            opacity: 0;
            animation: slideIn 0.4s ease forwards;
            border-left: 4px solid #f77532;
        }

        .lesson-item:hover {
            background: linear-gradient(135deg, #aad0d4, #68b8c1);
            transform: translateX(5px);
            color: white;
        }

        .lesson-item:nth-child(1) { animation-delay: 0.1s; }
        .lesson-item:nth-child(2) { animation-delay: 0.2s; }
        .lesson-item:nth-child(3) { animation-delay: 0.3s; }
        .lesson-item:nth-child(4) { animation-delay: 0.4s; }
        .lesson-item:nth-child(5) { animation-delay: 0.5s; }

        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .phase-icon {
            display: inline-block;
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }

        .lesson-count {
            background: #f77532;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 1rem;
            font-weight: normal;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .phases-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><div class="code-background" id="codeBackground"></div>
  <div class="floating-objects"><svg class="floating-object" width="80" height="80" viewbox="0 0 100 100"><circle cx="50" cy="50" r="35" fill="#2a8a92" opacity="0.3" /> <text x="50" y="60" text-anchor="middle" font-family="monospace" font-size="35" fill="white" font-weight="bold">
     &lt;-
    </text>
   </svg>
   <svg class="floating-object" width="70" height="70" viewbox="0 0 100 100"><rect x="15" y="25" width="70" height="50" rx="10" fill="#68b8c1" opacity="0.4" /> <text x="50" y="60" text-anchor="middle" font-family="monospace" font-size="40" fill="white" font-weight="bold">
     %&gt;%
    </text>
   </svg>
   <svg class="floating-object" width="60" height="60" viewbox="0 0 100 100"><circle cx="50" cy="50" r="30" fill="#aad0d4" opacity="0.3" /> <text x="50" y="60" text-anchor="middle" font-family="monospace" font-size="35" fill="white" font-weight="bold">
     ==
    </text>
   </svg>
   <svg class="floating-object" width="75" height="75" viewbox="0 0 100 100"><rect x="20" y="20" width="60" height="60" rx="15" fill="#c3e1e5" opacity="0.4" /> <text x="50" y="60" text-anchor="middle" font-family="monospace" font-size="30" fill="#2a8a92" font-weight="bold">
     %in%
    </text>
   </svg>
   <svg class="floating-object" width="65" height="65" viewbox="0 0 100 100"><ellipse cx="50" cy="50" rx="32" ry="25" fill="#f77532" opacity="0.3" /> <text x="50" y="58" text-anchor="middle" font-family="monospace" font-size="28" fill="white" font-weight="bold">
     !=
    </text>
   </svg>
   <svg class="floating-object" width="70" height="70" viewbox="0 0 100 100"><polygon points="50,20 80,70 20,70" fill="#68b8c1" opacity="0.3" /> <text x="50" y="60" text-anchor="middle" font-family="monospace" font-size="25" fill="white" font-weight="bold">
     &amp;
    </text>
   </svg>
   <svg class="floating-object" width="55" height="55" viewbox="0 0 100 100"><circle cx="50" cy="50" r="28" fill="#aad0d4" opacity="0.4" /> <text x="50" y="58" text-anchor="middle" font-family="monospace" font-size="30" fill="white" font-weight="bold">
     |
    </text>
   </svg>
   <svg class="floating-object" width="80" height="50" viewbox="0 0 120 60"><rect x="10" y="15" width="100" height="30" rx="15" fill="#c3e1e5" opacity="0.4" /> <text x="60" y="38" text-anchor="middle" font-family="monospace" font-size="20" fill="#2a8a92" font-weight="bold">
     filter()
    </text>
   </svg>
  </div>
  <div class="container">
   <header class="header">
    <h1 class="title" id="page-title">â€“ R for Transcriptomics &amp; Single-Cell</h1>
    <p class="subtitle" id="subtitle">Interactive Learning Platform</p>
   </header>
   <main class="phases-container">
    <div class="phase-card"><button class="phase-button" onclick="togglePhase('phase1')"> Phase 1 â€“ R as a Language <span class="lesson-count">5 lessons</span> </button>
     <div class="phase-description" style="margin: 1rem 0; padding: 1rem; background: rgba(0, 255, 65, 0.1); border-radius: 10px; font-style: italic; color: #00cc33; border: 1px solid rgba(0, 255, 65, 0.2);">
      Learn to speak R fluently. (2 Weeks)
     </div>
     <div class="lessons-container" id="phase1-lessons">
      <div class="lesson-item" onclick="selectLesson('Phase 1', 1)">
       Lesson 1: Alphabets of R â€” Symbols &amp; Basics
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 1', 2)">
       Lesson 2: Words â€” Data Types &amp; Objects
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 1', 3)">
       Lesson 3: Sentences â€” Data Structures
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 1', 4)">
       Lesson 4: Grammar â€” Syntax &amp; dplyr
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 1', 5)">
       Lesson 5: Storytelling â€” Visualization with ggplot2
      </div>
     </div>
    </div>
    <div class="phase-card"><button class="phase-button" onclick="togglePhase('phase2')"> Phase 2 â€“ Bulk RNA-Seq in R <span class="lesson-count">5 lessons</span> </button>
     <div class="phase-description" style="margin: 1rem 0; padding: 1rem; background: rgba(0, 255, 65, 0.1); border-radius: 10px; font-style: italic; color: #00cc33; border: 1px solid rgba(0, 255, 65, 0.2);">
      Bridge R coding with biological insights. (3 Weeks)
     </div>
     <div class="lessons-container" id="phase2-lessons">
      <div class="lesson-item" onclick="selectLesson('Phase 2', 'Lesson 1')">
       Lesson 1: RNA-Seq Workflow Concepts
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 2', 'Lesson 2')">
       Lesson 2: Normalization &amp; DE Testing (DESeq2/edgeR)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 2', 'Lesson 3')">
       Lesson 3: Interpreting Results (MA, Volcano plots)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 2', 'Lesson 4')">
       Lesson 4: Exploratory Data Analysis (PCA, clustering, heatmaps)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 2', 'Lesson 5')">
       Lesson 5: Pathway Enrichment (GO/KEGG using clusterProfiler)
      </div>
     </div>
    </div>
    <div class="phase-card"><button class="phase-button" onclick="togglePhase('phase3')"> Phase 3 â€“ Visualization &amp; Reporting <span class="lesson-count">2 lessons</span> </button>
     <div class="phase-description" style="margin: 1rem 0; padding: 1rem; background: rgba(0, 255, 65, 0.1); border-radius: 10px; font-style: italic; color: #00cc33; border: 1px solid rgba(0, 255, 65, 0.2);">
      Create clean, professional visual outputs. (1 Week)
     </div>
     <div class="lessons-container" id="phase3-lessons">
      <div class="lesson-item" onclick="selectLesson('Phase 3', 'Lesson 1')">
       Lesson 1: Publication-ready Plots (ComplexHeatmap, ggplot themes)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 3', 'Lesson 2')">
       Lesson 2: RMarkdown Reports
      </div>
     </div>
    </div>
    <div class="phase-card"><button class="phase-button" onclick="togglePhase('phase4')"> Phase 4 â€“ Single-Cell RNA-Seq with Seurat <span class="lesson-count">5 lessons</span> </button>
     <div class="phase-description" style="margin: 1rem 0; padding: 1rem; background: rgba(0, 255, 65, 0.1); border-radius: 10px; font-style: italic; color: #00cc33; border: 1px solid rgba(0, 255, 65, 0.2);">
      Move from bulk to single-cell analysis. (3â€“4 Weeks)
     </div>
     <div class="lessons-container" id="phase4-lessons">
      <div class="lesson-item" onclick="selectLesson('Phase 4', 'Lesson 1')">
       Lesson 1: Bulk vs Single-Cell Concepts
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 4', 'Lesson 2')">
       Lesson 2: Seurat Basics (Import, QC, Normalization)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 4', 'Lesson 3')">
       Lesson 3: Dimensionality Reduction (PCA, UMAP, tSNE)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 4', 'Lesson 4')">
       Lesson 4: Clustering &amp; Marker Identification
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 4', 'Lesson 5')">
       Lesson 5: Biological Interpretation (Annotation, Azimuth)
      </div>
     </div>
    </div>
    <div class="phase-card"><button class="phase-button" onclick="togglePhase('phase5')"> Phase 5 â€“ Advanced scRNA Topics <span class="lesson-count">3 lessons</span> </button>
     <div class="phase-description" style="margin: 1rem 0; padding: 1rem; background: rgba(0, 255, 65, 0.1); border-radius: 10px; font-style: italic; color: #00cc33; border: 1px solid rgba(0, 255, 65, 0.2);">
      Explore advanced research workflows. (Optional, 2â€“3 Weeks)
     </div>
     <div class="lessons-container" id="phase5-lessons">
      <div class="lesson-item" onclick="selectLesson('Phase 5', 'Lesson 1')">
       Lesson 1: Trajectory Inference (Monocle3)
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 5', 'Lesson 2')">
       Lesson 2: Data Integration &amp; Batch Correction
      </div>
      <div class="lesson-item" onclick="selectLesson('Phase 5', 'Lesson 3')">
       Lesson 3: Cluster-Level Pathway Enrichment
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
        // Configuration object for editable features
        const defaultConfig = {
            page_title: "â€“ R for Transcriptomics & Single-Cell",
            subtitle: "Interactive Learning Platform",
            background_color: "#e7e4de",
            surface_color: "#c3e1e5",
            text_color: "#2a8a92",
            primary_action_color: "#68b8c1",
            secondary_action_color: "#f77532"
        };

        let config = { ...defaultConfig };

        // ðŸŸ¢ CORRECTED: Phase toggle functionality to ensure smooth dropdown and lesson animation.
        function togglePhase(phaseId) {
            const lessonsContainer = document.getElementById(phaseId + '-lessons');
            const isExpanded = lessonsContainer.classList.contains('expanded');
            
            // Close all other phases
            document.querySelectorAll('.lessons-container').forEach(container => {
                if (container.id !== lessonsContainer.id) {
                    container.classList.remove('expanded');
                    // Immediately hide lessons visually when collapsing others
                    container.querySelectorAll('.lesson-item').forEach(lesson => {
                        lesson.style.animation = 'none';
                        lesson.style.opacity = '0';
                        lesson.style.transform = 'translateX(-20px)';
                    });
                }
            });
            
            // Toggle current phase
            if (!isExpanded) {
                lessonsContainer.classList.add('expanded');
                
                // Ensure lessons are ready to animate in by resetting properties
                lessonsContainer.querySelectorAll('.lesson-item').forEach((lesson) => {
                    lesson.style.opacity = '0'; 
                    lesson.style.transform = 'translateX(-20px)';
                });

                // Restart slideIn animations after a slight delay to ensure the max-height transition starts first
                setTimeout(() => {
                    lessonsContainer.querySelectorAll('.lesson-item').forEach((lesson, index) => {
                        // Remove previous animation to allow re-triggering
                        lesson.style.animation = 'none';
                        lesson.offsetHeight; // Trigger reflow
                        
                        // Apply the slideIn animation
                        lesson.style.animation = `slideIn 0.4s ease forwards`;
                        lesson.style.animationDelay = `${(index + 1) * 0.1}s`;
                    });
                }, 100); // Delay ensures CSS transition has started
                
            } else {
                // Collapse the current phase
                lessonsContainer.classList.remove('expanded');
                
                // Immediately remove slide-in animation styles when collapsing
                lessonsContainer.querySelectorAll('.lesson-item').forEach((lesson) => {
                    lesson.style.animation = 'none';
                    lesson.style.opacity = '0';
                    lesson.style.transform = 'translateX(-20px)';
                });
            }
        }

        // ðŸ”— MODIFIED: Lesson selection functionality with conditional linking/notification.
        function selectLesson(phase, No) {
            // --- Define the READY Lesson here ---
            // If Phase 1, Lesson 1 is ready, navigate to its HTML file.
            if (phase === 'Phase 1') {
                window.location.href = "./Lesson" + No + ".html";
                return; // Stop execution after navigation
            }
            
            // --- Fallback for In-Progress Lessons (Shows the notification) ---
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #f77532, #d15c1e); /* In-progress color */
                color: white;
                padding: 1rem 2rem;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = `Lesson In Progress: ${phase} - ${lesson}`;
            
            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                // Check if notification is still in the DOM before attempting to animate/remove
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Element SDK implementation
        async function onConfigChange(newConfig) {
            config = { ...config, ...newConfig };
            
            // Update text content
            const titleElement = document.getElementById('page-title');
            const subtitleElement = document.getElementById('subtitle');
            
            if (titleElement) {
                titleElement.textContent = config.page_title || defaultConfig.page_title;
            }
            if (subtitleElement) {
                subtitleElement.textContent = config.subtitle || defaultConfig.subtitle;
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["page_title", config.page_title || defaultConfig.page_title],
                ["subtitle", config.subtitle || defaultConfig.subtitle]
            ]);
        }

        // Dynamic Code Background
        const rCodeSnippets = [
            'library(DESeq2)',
            'data <- read.csv("counts.csv")',
            'dds <- DESeqDataSetFromMatrix(countData, colData, design = ~ condition)',
            'dds <- DESeq(dds)',
            'res <- results(dds)',
            'plotMA(res)',
            'library(ggplot2)',
            'ggplot(data, aes(x = log2FoldChange, y = -log10(padj))) + geom_point()',
            'library(Seurat)',
            'pbmc <- CreateSeuratObject(counts = pbmc.data)',
            'pbmc <- NormalizeData(pbmc)',
            'pbmc <- FindVariableFeatures(pbmc)',
            'pbmc <- ScaleData(pbmc)',
            'pbmc <- RunPCA(pbmc)',
            'pbmc <- RunUMAP(pbmc, dims = 1:10)',
            'pbmc <- FindNeighbors(pbmc, dims = 1:10)',
            'pbmc <- FindClusters(pbmc, resolution = 0.5)',
            'DimPlot(pbmc, reduction = "umap")',
            'markers <- FindAllMarkers(pbmc)',
            'VlnPlot(pbmc, features = c("nFeature_RNA", "nCount_RNA"))',
            'library(clusterProfiler)',
            'ego <- enrichGO(gene = genes, OrgDb = org.Hs.eg.db)',
            'dotplot(ego)',
            'library(ComplexHeatmap)',
            'Heatmap(mat, cluster_rows = TRUE, cluster_columns = TRUE)',
            'library(dplyr)',
            'data %>% filter(padj < 0.05) %>% arrange(log2FoldChange)',
            'library(tidyr)',
            'data %>% pivot_longer(cols = everything())',
            'counts_matrix[counts_matrix < 10] <- 0',
            'normalized_counts <- log2(counts + 1)',
            'pca_result <- prcomp(t(normalized_counts))',
            'plot(pca_result$x[,1], pca_result$x[,2])'
        ];

        function createCodeBackground() {
            const codeBackground = document.getElementById('codeBackground');
            
            function addCodeLine() {
                const codeLine = document.createElement('div');
                codeLine.className = 'code-line';
                codeLine.textContent = rCodeSnippets[Math.floor(Math.random() * rCodeSnippets.length)];
                
                // Random vertical position
                codeLine.style.top = Math.random() * 100 + '%';
                
                // Random animation duration (speed)
                const duration = Math.random() * 15 + 10; // 10-25 seconds
                codeLine.style.animationDuration = duration + 's';
                
                // Random opacity variation
                codeLine.style.opacity = Math.random() * 0.3 + 0.1; // 0.1-0.4
                
                codeBackground.appendChild(codeLine);
                
                // Remove the line after animation completes
                setTimeout(() => {
                    if (codeLine.parentNode) {
                        codeLine.parentNode.removeChild(codeLine);
                    }
                }, duration * 1000);
            }
            
            // Add initial lines
            for (let i = 0; i < 8; i++) {
                setTimeout(() => addCodeLine(), i * 2000);
            }
            
            // Continue adding lines periodically
            setInterval(addCodeLine, 3000);
        }

        // Start code background animation
        createCodeBackground();

        // Initialize Element SDK
        if (window.elementSdk) {
		
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }
		
		// Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Always start with login screen
            const name = sessionStorage.getItem("userName");
			if (!name) {
                alert('Please enter your name to continue.');
                window.location.href = "./Login.html";
				//return;
            }
        });
    </script>
 </body>
</html>